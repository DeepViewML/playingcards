schema: '2.0'
stages:
  train:
    cmd: python -m deepview.modelpack.trainers.detection --config detection.yaml --dvclive
      out/dvclive
    deps:
    - path: dataset
      hash: md5
      md5: 6102dc0a639b44241dcd8fc0be86e221.dir
      size: 332912867
      nfiles: 19
    - path: detection.yaml
      hash: md5
      md5: 8fff30b3b5268cf04a718ec90352ec39
      size: 2488
    outs:
    - path: out/chkpts/config.json
      hash: md5
      md5: cc47dea5d4e09d1157ef4344a26227c2
      size: 1542
    - path: out/chkpts/inference_model
      hash: md5
      md5: 3ba6fa0aea9ff61ce70b831358863c6d.dir
      size: 25591596
      nfiles: 5
    - path: out/chkpts/inference_model_weights.h5
      hash: md5
      md5: e5a2fd091f25e8f3811b6e2b563dd50b
      size: 23722432
    - path: out/chkpts/labels.txt
      hash: md5
      md5: e8d3e10ea4d62e671d825c01cb37f4f3
      size: 65
    - path: out/chkpts/train_model_weights.h5
      hash: md5
      md5: b5404ba7e903597dd20c4dd722ddae81
      size: 23724944
  zip:
    cmd: tar czf out/saved_model.tar.gz out/chkpts/inference_model
    outs:
    - path: out/saved_model.tar.gz
      hash: md5
      md5: 6e17af0f789cf1526441ab960a9e2f6b
      size: 22162235
  convert-tensor:
    cmd: python -m deepview.converter --quantize  --quant_normalization unsigned --samples
      dataset/quant-samples  --num_samples 15  --default_shape 1,320,320,3 --labels
      out/chkpts/labels.txt --input_type uint8  --output_type int8  --quant-tensor
      out/chkpts/inference_model out/modelpack-playingcards-tensor.rtm
    outs:
    - path: out/modelpack-playingcards-tensor.rtm
      hash: md5
      md5: 654b956c854af25d4069838bd5265782
      size: 5942256
  convert-channel:
    cmd: python -m deepview.converter --quantize  --quant_normalization unsigned --samples
      dataset/quant-samples  --num_samples 15  --labels out/chkpts/labels.txt --input_type
      uint8  --output_type int8  --default_shape 1,320,320,3  out/chkpts/inference_model
      out/modelpack-playingcards-320x320-channel.rtm
    outs:
    - path: out/modelpack-playingcards-320x320-channel.rtm
      hash: md5
      md5: ca3d63c8183ead0e69d171c46b295f12
      size: 5993312
  print:
    cmd: echo *params:model
  shape:
    cmd: ls -l
